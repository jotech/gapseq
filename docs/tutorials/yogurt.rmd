# Lactic acid bacteria in yogurt production
`r Sys.Date()`

*Lactobacillus delbrueckii* subsp. *bulgaricus* and *Streptococcus thermophilus* are both lactic acid bacteria, which are frequently used for the production of yogurt. The organisms differ in their lactose degradation and their fermentation end products. In this tutorial, genome-scale metabolic models will be reconstructed using **gapseq** starting from the organisms' genomes in multi-protein sequences fasta file (translated sequences of protein-coding genes).

##### Input files

- Genome assemblies:
  - *Lactobacillus delbrueckii* subsp. *bulgaricus* ATCC 11842 = JCM 1002. RefSeq: `GCF_000056065.1`
  - *Streptococcus thermophilus* ATCC 19258. RefSeq: `GCF_010120595.1`
- Growth media (milk) file: `milk.csv` 
  This growth media is based on the main ingredients described for whole milk (without fatty acids), as listed [here](https://frida.fooddata.dk/food/1265?lang=en).

##### Preparations

Download required files and rename assembly files for the ease of this tutorial.

```{sh, eval=TRUE, echo=TRUE, results='hide'}
# Download genome assemblies from NCBI (RefSeq) in protein sequences
wget -q -O ldel.faa.gz ftp://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/000/056/065/GCF_000056065.1_ASM5606v1/GCF_000056065.1_ASM5606v1_protein.faa.gz
wget -q -O sthe.faa.gz ftp://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/010/120/595/GCF_010120595.1_ASM1012059v1/GCF_010120595.1_ASM1012059v1_protein.faa.gz

# Download gapfill-medium file from github
wget -q https://github.com/Waschina/gapseq.tutorial.data/raw/master/yogurt/milk.csv
```

##### gapseq reconstruction pipeline

(1) Reaction & pathway prediction
(2) Transporter prediction
(3) Draft model reconstruction
(4) Gapfilling

```{sh, eval=TRUE, echo=TRUE, results='hide'}
modelA="ldel"
modelB="sthe"

# (1) Reaction & Pathway prediction
gapseq find -p all -b 200 -m auto -t auto -A diamond $modelA.faa.gz
gapseq find -p all -b 200 -m auto -t auto -A diamond $modelB.faa.gz

# (2) Transporter prediction
gapseq find-transport -b 200 -A diamond $modelA.faa.gz 
gapseq find-transport -b 200 -A diamond $modelB.faa.gz

# (3) Building Draft Model - based on Reaction-, Pathway-, and Transporter prediction
gapseq draft -r $modelA-all-Reactions.tbl -t $modelA-Transporter.tbl -p $modelA-all-Pathways.tbl -u 200 -l 100
gapseq draft -r $modelB-all-Reactions.tbl -t $modelB-Transporter.tbl -p $modelB-all-Pathways.tbl -u 200 -l 100

# (4) Gapfilling
gapseq fill -m $modelA-draft.RDS -n milk.csv -b 100
gapseq fill -m $modelB-draft.RDS -n milk.csv -b 100
```

##### FBA and FVA prediction of metabolic by-products

Here, we will use the R-Package [`cobrar`](https://waschina.github.io/cobrar/) to perform Flux-Balance-Analysis (FBA) and Flux-Variability-Analysis (FVA) with the two reconstructed network models.

First, we define a function, that automatically performs FBA with the minimization of total flux (MTF) as secondary objective and FVA for all exchange reactions. The function also summarizes the results in a sorted `data.table`.

```{r, eval=TRUE, echo=TRUE}
library(cobrar)
library(data.table)

getMetaboliteProduction <- function(mod) {
  sol.mtf <- pfba(mod)
  dt.mtf  <- data.table(getExchanges(mod, sol.mtf))
  dt.mtf <- dt.mtf[flux >= 1e-5 & ID != "EX_cpd11416_c0"]
  
  return(dt.mtf[order(-flux)])
}
```

Now, we can apply this function to the network models of *L. delbrueckii* and *S. thermophilus* to predict the top 10 produced metabolic by-products.

Results for *L. delbrueckii* (`ld`):

```{r, eval=TRUE, echo=TRUE}
ld <- readRDS("ldel.RDS") # for L. delbrueckii
getMetaboliteProduction(ld)[1:10]
```


Results for S. thermophilus (`st`):

```{r cleanup, eval=TRUE, echo=TRUE}
st <- readRDS("sthe.RDS") # for S. thermophilus
getMetaboliteProduction(st)[1:10]
```


As expected, both organisms produce lactate in the FBA+MTF solution. In contrast to *S. thermophilus*, the FBA simulation predicted a release of galactose by *L. debrueckii*. In fact, *L. debrueckii* is usually reported to be galactose-negative; i.e. does not produce acid from this hexose ([https://bacdive.dsmz.de/strain/6449](https://bacdive.dsmz.de/strain/6449)) and utilized only the glucose part of lactose, while *S. thermophilus* has been reported to be galactose-positive ([https://bacdive.dsmz.de/strain/14786](https://bacdive.dsmz.de/strain/14786)).

```{sh, include=FALSE}
rm ldel*
rm sthe*
rm milk.csv
```
