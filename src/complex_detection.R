complex_detection <- function(seq.id) {
  if(length(seq.id) == 0) {
    return(character(0L))
  }

  require(stringr)

  # patterns
  com.synonymes <- "(\\bsubunit\\b|\\bchain\\b|\\bpolypeptide\\b|\\bcomponent\\b)"
  com.pat1  <- paste0(com.synonymes, " [1-9]+([A-Z])?\\b")
  com.pat2  <- paste0(com.synonymes, " [A-Z]+\\b")
  com.pat3  <- paste0("\\b[A-Z]+ ", com.synonymes)
  com.pat4  <- paste0("(alpha|beta|gamma|delta|epsilon|zeta|eta|theta|iota|kappa|lambda|my|ny|omikron|pi|rho|sigma) ", com.synonymes)
  com.pat5  <- paste0(com.synonymes, " (alpha|beta|gamma|delta|epsilon|zeta|eta|theta|iota|kappa|lambda|my|ny|omikron|pi|rho|sigma)")
  com.pat6  <- paste0(com.synonymes, " [A-Z][A-z]+\\b")
  com.pat7  <- paste0("(large|medium|small) ", com.synonymes)
  com.pat8  <- paste0("(alpha|beta|gamma|delta|epsilon|zeta|eta|theta|iota|kappa|lambda|my|ny|omikron|pi|rho|sigma)-", com.synonymes)
  hits <- str_extract(seq.id, paste0(com.pat1,"|",com.pat2,"|",com.pat3,"|",com.pat4,"|",com.pat5,"|",com.pat6,"|",com.pat7,"|",com.pat8))

  hits <- gsub("subunit|chain|polypeptide|component", "Subunit", hits)

  # change order (alpha subunit => subunit alpha)
  hits <- str_replace(hits, "([A-Z]+) Subunit", "Subunit \\1")
  hits <- str_replace(hits, "(alpha|beta|gamma|delta|epsilon|zeta|eta|theta|iota|kappa|lambda|my|ny|omikron|pi|rho|sigma) Subunit", "Subunit \\1")
  hits <- str_replace(hits, "(alpha|beta|gamma|delta|epsilon|zeta|eta|theta|iota|kappa|lambda|my|ny|omikron|pi|rho|sigma)-Subunit", "Subunit \\1")
  hits <- str_replace(hits, "(small|medium|large) Subunit", "Subunit \\1")

  # latin numbers
  latin <- c("I", "II", "III", "IV", "V", "VI", "VII", "VIII", "IX", "X", "XI", "XII", "XIII", "XIV", "XV")
  pattern0 <- paste0('(?i)\\b',rev(latin))
  replace0 <- as.character(15:1)
  hits <- str_replace_all(hits, setNames(replace0, pattern0))

  # letter numbers
  pattern1 <- paste0('(?i)\\b',LETTERS[1:26], '\\b')
  replace1 <- as.character(1:26)
  hits <- str_replace_all(hits, setNames(replace1, pattern1))

  # greek numbers
  greek <- c("alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","my","ny","omikron","pi","rho","sigma")
  pattern2 <- paste0('(?i)\\b',greek, '\\b')
  replace2 <- as.character(1:17)
  hits <- str_replace_all(hits, setNames(replace2, pattern2))

  #
  pattern3 <- c("small", "medium", "large")
  replace3 <- as.character(1:3)
  hits <- str_replace_all(hits, setNames(replace3, pattern3))

  # other corrections
  hits <- str_replace(hits, "(Subunit [0-9]+)[A-z]", "\\1") # how to handle sub-sub-complexes?

  # remove subunit hits with low amount of sequences (~false hits)
  hits.tab <- table(hits)
  #print(hits.tab)
  if( dim(hits.tab)>0 & mean(hits.tab) >= 10 ){
    hits.low <- names(hits.tab)[which( hits.tab < 5 )]
    hits[which(hits %in% hits.low)] <- NA
  }

  # try to get high quality (i.e. ordered subunits) and remove everything else if coverage is high enough
  hits.tab <- table(hits)
  hits.sel <- grep("Subunit [0-9]+", names(hits.tab), value=T)
  hits.sel.cov <- sum(hits.tab[which(names(hits.tab) %in% hits.sel)])
  hits.sel.quali <- hits.sel.cov / length(seq.id)
  if( hits.sel.quali >= 0.66 ){
    hits[which(!hits %in% hits.sel)] <- NA
  }

  # if 20% or less of the sequences have now subunit info in header, set all subunits to NA
  if(sum(!is.na(hits))/length(hits) <= 0.2) {
    hits <- rep(NA_character_, length(hits))
  }

  return(hits)
}
